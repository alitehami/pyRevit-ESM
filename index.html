<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CSS Integration JSON Editor Example</title>
    <script type="text/javascript" src="lib/yaml.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/spectre.css/dist/spectre.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css"
    />

    <!-- <link rel="stylesheet" href="    https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/css/jsoneditor.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.js">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.0/dist/js/bootstrap.min.js">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"> -->

    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js"></script>

    <script>
      // Set the default CSS theme and icon library globally
      JSONEditor.defaults.theme = "spectre";
      JSONEditor.defaults.iconlib = "spectre";
      // JSONEditor.defaults.theme = "bootstrap3";
      // JSONEditor.defaults.iconlib = "fontawesome5";
    </script>
    <style>
      .container {
        max-width: 80%;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <input type="file" name="inputfile" id="inputfile" />
      <br />

      <pre id="output"></pre>

      <a id="download_click">DOWNLOAD</a>
    </div>

    <div class="container">
      <div class="columns">
        <h1 class="col-md-12">pyRevit Extensions Settings Manager</h1>
      </div>
      <div class="columns">
        <div class="column col-md-12">
          <button id="restore" class="secondary tiny">
            Load Imported
          </button>
          <button id="submit" class="tiny">(console.log)</button>
          <button id="submit_json" class="tiny">Download JSON</button>
          <button id="submit_yaml" class="tiny">Download YAML</button>
          <span id="valid_indicator" class="label"></span>
        </div>
      </div>
      <div class="columns">
        <div class="column col-md-12" id="editor_holder"></div>
      </div>
    </div>

    <script>
      // This is the starting value for the editor
      // We will use this to seed the initial editor
      // and to provide a "Restore to Default" button.
      //       var starting_value =
      // {
      //   name: "John Smith",
      //   age: 35,
      //   gender: "male",
      //   location: {
      //     city: "San Francisco",
      //     state: "California",
      //   },
      //   pets: [
      //     {
      //       name: "Spot",
      //       type: "dog",
      //       fixed: true,
      //     },
      //     {
      //       name: "Whiskers",
      //       type: "cat",
      //       fixed: false,
      //     },
      //   ],
      // };

      let starting_value = {
        builtin: "True",
        default_enabled: "True",
        type: "extension",
        rocket_mode_compatible: "True",
        name: "pyRevitTools",
        description: "IronPython Scripts for Autodesk Revit",
        author: "Ehsan Iran-Nejad",
        author_profile: "https://keybase.io/ein",
        url: "https://github.com/eirannejad/pyRevit.git",
        website: "http://eirannejad.github.io/pyRevit/",
        image: "",
        authusers: ["username1", "username2", "username3"],
        templates: {
          author: "Ehsan Iran-Nejad",
          docpath: "https://www.youtube.com/watch?v=",
        },
        dependencies: [],
      };

      // Initialize the editor
      var editor = new JSONEditor(document.getElementById("editor_holder"), {
        // Enable fetching schemas via ajax
        ajax: true,

        // The schema for the editor
        schema: {
          $ref: "/schemas/pyrevit-extensions-manager.json",
          format: "grid",
        },

        // Seed the form with a starting value
        // startval: starting_value,
        // startval: "_sampleData/extension.json",
      });

      // Hook up the submit button to log to the console
      document.getElementById("submit").addEventListener("click", function () {
        // Get the value from the editor
        console.log(
          "<<<JSON OBJECT>>>\n",
          editor.getValue(),
          "\n\n<<<YAML STRING>>>\n",
          JSONtoYAML(editor.getValue())
        );
      });

      // Hook up the Restore to Default button
      document.getElementById("restore").addEventListener("click", function () {
        let o = JSON.parse(document.getElementById("output").textContent);
        editor.setValue(o);
        // editor.setValue(starting_value);
      });

      // Hook up the validation indicator to update its
      // status whenever the editor changes
      editor.on("change", function () {
        // Get an array of errors from the validator
        var errors = editor.validate();

        var indicator = document.getElementById("valid_indicator");

        // Not valid
        if (errors.length) {
          indicator.className = "label alert";
          indicator.textContent = "not valid";
        }
        // Valid
        else {
          indicator.className = "label success";
          indicator.textContent = "valid";
        }
      });
    </script>
    <script src="js/app.js"></script>
  </body>
</html>
